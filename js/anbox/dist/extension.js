(()=>{"use strict";var e={938:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pythonCmd=t.isLittleEndian=t.OS=t.translationsConfigFile=t.locale=t.language=t.userAgent=t.platform=t.isIOS=t.isWeb=t.isNative=t.isLinuxSnap=t.isLinux=t.isMacintosh=t.isWindows=t.platformToString=t.isElectronSandboxed=t.globals=void 0;const i=n(17),o="en";let s,r,a,l,c=!1,d=!1,h=!1,p=!1,u=!1,w=!1,g=!1,v=o;t.globals="object"==typeof self?self:"object"==typeof global?global:{},void 0!==t.globals.vscode&&void 0!==t.globals.vscode.process?l=t.globals.vscode.process:"undefined"!=typeof process&&(l=process);const m="string"==typeof l?.versions?.electron&&"renderer"===l.type;if(t.isElectronSandboxed=m&&l?.sandboxed,"object"!=typeof navigator||m)if("object"==typeof l){c="win32"===l.platform,d="darwin"===l.platform,h="linux"===l.platform,p=h&&!!l.env.SNAP&&!!l.env.SNAP_REVISION,s=o,v=o;const e=l.env.VSCODE_NLS_CONFIG;if(e)try{const t=JSON.parse(e),n=t.availableLanguages["*"];s=t.locale,v=n||o,r=t._translationsConfigFile}catch(e){}u=!0}else console.error("Unable to resolve platform.");else a=navigator.userAgent,c=a.indexOf("Windows")>=0,d=a.indexOf("Macintosh")>=0,g=(a.indexOf("Macintosh")>=0||a.indexOf("iPad")>=0||a.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,h=a.indexOf("Linux")>=0,w=!0,s=navigator.language,v=s;t.platformToString=function(e){switch(e){case 0:return"Web";case 1:return"Mac";case 2:return"Linux";case 3:return"Windows"}};let b=0;d?b=1:c?b=3:h&&(b=2),t.isWindows=c,t.isMacintosh=d,t.isLinux=h,t.isLinuxSnap=p,t.isNative=u,t.isWeb=w,t.isIOS=g,t.platform=b,t.userAgent=a,t.language=v,t.locale=s,t.translationsConfigFile=r,t.OS=d||g?2:c?1:3;let f=!0,x=!1;t.isLittleEndian=function(){if(!x){x=!0;const e=new Uint8Array(2);e[0]=1,e[1]=2;const t=new Uint16Array(e.buffer);f=513===t[0]}return f},t.pythonCmd=function(e){let n="python3";return 1===t.OS&&(n="py"),i.join(e,n)}},496:e=>{e.exports=require("vscode")},81:e=>{e.exports=require("child_process")},17:e=>{e.exports=require("path")}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,n),s.exports}var i={};(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=n(496),o=n(81),s=n(17),r=n(938);function a(e){return console.log(e),{enableScripts:!0,localResourceRoots:[t.Uri.joinPath(e,"dist"),t.Uri.joinPath(e,"out"),t.Uri.joinPath(e,"build"),t.Uri.joinPath(e,"public"),t.Uri.joinPath(e,"target"),t.Uri.joinPath(e,"volume"),t.Uri.joinPath(e,"res")]}}e.activate=function(e){l.log||(l.log=t.window.createOutputChannel("Anbox")),l.log.appendLine("Starting Anbox ..."),e.subscriptions.push(t.commands.registerCommand("anbox.load",((t,n)=>{l.init(e,t),l.currentPanel?.load(e.extensionUri,t)}))),e.subscriptions.push(t.commands.registerCommand("anbox.refresh",(()=>{l.currentPanel&&l.currentPanel.refresh()}))),e.subscriptions.push(t.commands.registerCommand("anbox.restartServer",(()=>{l.currentPanel?l.currentPanel.startup():t.window.showInformationMessage("Sever only started when Anbox is loaded!")}))),e.subscriptions.push(t.commands.registerCommand("anbox.shutdownServer",(()=>{l.currentPanel&&(l.currentPanel.serv.starting=!1,l.currentPanel.close())}))),t.window.registerWebviewPanelSerializer&&t.window.registerWebviewPanelSerializer(l.viewType,{async deserializeWebviewPanel(t,n){console.log(`Got state: ${n}`),t.webview.options=a(e.extensionUri),l.revive(t,void 0,e.extensionUri)}})},e.deactivate=function(){l.currentPanel&&l.currentPanel.close()};class l{constructor(e,n,i){this._disposables=[],this.page={port:"8888",host:"localhost",html:"index.html",style:"background-color: #ccc"},this._panel=e,this.serv=n||{pythonPath:"",webroot:"",starting:!1,webpackTerm:void 0},this._extensionUri=i,this.loadOnline(),this._panel.onDidDispose((()=>this.dispose()),null,this._disposables),this._panel.onDidChangeViewState((e=>{this._panel.visible&&this.refresh()}),null,this._disposables),this._panel.webview.onDidReceiveMessage((e=>{"alert"!==e.command||t.window.showErrorMessage(e.text)}),null,this._disposables)}static init(e,n){if(l.currentPanel)return l.currentPanel;if(!n){let e=t.window.activeTextEditor?.document.uri;e?.fsPath&&new Set([".html",".htm"]).has(s.extname(e?.fsPath))&&(n=t.window.activeTextEditor?.document.uri)}if(n){let i={pythonPath:e.asAbsolutePath(s.join("packages","anserv.py")),webroot:this.getWorkspaceWebFolder(n),starting:!1,webpackTerm:void 0};l.log.appendLine("Loading "+i.webroot);const o=t.window.createWebviewPanel(l.viewType,"Anbox",t.window.activeTextEditor?.viewColumn||t.ViewColumn.One);return o.webview.options=a(e.extensionUri),l.revive(o,i,e.extensionUri)}t.window.showInformationMessage("Anbox don't know which html page to load!")}static revive(e,t,n){return l.log.appendLine("Anbox webview revived."),l.currentPanel=new l(e,t,n),l.currentPanel.serv=t,l.currentPanel}async load(e,n){let i=this.getServ(n);if(!i.webroot)return t.window.showErrorMessage("No html page found."),void l.log.appendLine("No html page found.");if(!i.starting)try{await l.currentPanel.startup()}catch(e){t.window.showInformationMessage(e.getMessage())}const o=t.window.activeTextEditor?t.window.activeTextEditor.viewColumn:void 0;if(!l.currentPanel){const s=t.window.createWebviewPanel(l.viewType,`Anbox - ${l.filename(n)}`,o||t.ViewColumn.One,a(e));l.log.append("Open page "+l.filename(n)),l.currentPanel=new l(s,i,e)}this.refresh(),l.currentPanel._panel.reveal(o)}getServ(e){return e&&(this.serv.webroot=l.getWorkspaceWebFolder(e)),this.serv}setPage(e){this.page.html=e}async startup(){const e=`${(0,r.pythonCmd)("")} ${this.serv.pythonPath} -b 0.0.0.0 -w ${this.serv.webroot} ${this.page.port} &`;this.serv.starting=!0,l.log.appendLine(e),t.window.showInformationMessage("Starting Anbox server at "+this.serv.webroot),new Promise(((n,i)=>{o.exec(e,((e,o)=>e?(this.serv.starting=!1,l.log.appendLine(e.message),t.window.showInformationMessage("Starting Anbox server failed. "+e.message),i(e)):(this.serv.starting=!1,l.log.appendLine(o.toString()),n(o))))}))}dispose(){for(l.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}loadOnline(){this._panel.webview,this._panel.webview.html=this.getAnclientPage(this.page)}refresh(){this._panel.webview.html="",this._panel.webview.html=this.getAnclientPage(this.page)}getAnclientPage(e){return`<!DOCTYPE html>\n\t\t<html lang="en">\n\t\t<head>\n\t\t\t<meta charset="UTF-8">\n\t\t\t<meta name="viewport" content="width=device-width, initial-scale=1.0">\n\t\t</head>\n\t\t<body>\n\t\t\t<p id="lines-of-code-counter">${e.html}\n\t\t\t<input type='button' value='refresh' onclick='console.log("xxx");\n\t\t\t\tdocument.getElementById("i-anbox").src = document.getElementById("i-anbox").src\n\t\t\t'\n\t\t\t/>\n\t\t\t</p>\n\t\t\t<iframe id='i-anbox' src="${l.url(e)}" width="100%" height="720px" style="${e.style}" ></iframe>\n\t\t</body>\n\t\t</html>`}close(){l.log.appendLine("Shuting down: "+this.page.html),t.window.showInformationMessage("Shuting down Anbox server. "+this.page.html),this.page.html="?_shut-down_=True";let e=l.url(this.page);console.log(e),this._panel.webview.html="",this._panel.webview.html=`<!DOCTYPE html>\n\t\t<html lang="en">\n\t\t<head>\n\t\t\t<meta charset="UTF-8">\n\t\t\t<meta name="viewport" content="width=device-width, initial-scale=1.0">\n\t\t</head>\n\t\t<body>\n\t\t\t<iframe src="${e}" width="100%" height="720px" style="${this.page.style}" ></iframe>\n\t\t</body>\n\t\t</html>`}static url(e){return`http://${e.host}:${e.port}/${e.html}`}static filename(e){return s.basename(e.path)}static getWorkspaceWebFolder(e){const n=e.fsPath;let i=t.workspace.workspaceFolders;if(!i)throw Error("Why workspaceFolder is null?");let o=i.map((e=>e.uri.fsPath)).filter((e=>n?.startsWith(e)))[0];return o=["dist","out","build","publc","target","volume","res"].filter((e=>n?.startsWith(s.join(o,e)))).map((e=>s.join(o,e)))[0],console.log("webroot:",o),o}}l.viewType="anbox"})(),module.exports=i})();